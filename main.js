/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var U=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var _=(y,c)=>{for(var i in c)U(y,i,{get:c[i],enumerable:!0})},tt=(y,c,i,t)=>{if(c&&typeof c=="object"||typeof c=="function")for(let s of Z(c))!Q.call(y,s)&&s!==i&&U(y,s,{get:()=>c[s],enumerable:!(t=X(c,s))||t.enumerable});return y};var et=y=>tt(U({},"__esModule",{value:!0}),y);var it={};_(it,{RuleRegistry:()=>I,default:()=>Y});module.exports=et(it);var q=require("obsidian");var b=require("obsidian"),H=class extends b.PluginSettingTab{constructor(i,t){super(i,t);this.plugin=t}display(){let{containerEl:i}=this;i.empty(),new b.Setting(i).setName("\u8BED\u8A00 / Language").addDropdown(r=>r.addOption("zh","\u4E2D\u6587").addOption("en","English").setValue(this.plugin.settings.language||"zh").onChange(async l=>{this.plugin.settings.language=l,await this.plugin.saveSettings(),this.display()}));let t=this.plugin.settings.language==="en",s=t?"Knowledge Ark Diagnostic Center Settings":"\u77E5\u8BC6\u65B9\u821F\u8BCA\u65AD\u4E2D\u5FC3\u8BBE\u7F6E";i.createEl("h3",{text:s});let e=(r,l)=>t?l:r;new b.Setting(i).setName(e("\u5FC5\u586B\u5143\u6570\u636E\u5B57\u6BB5","Required Metadata Fields")).setDesc(e("\u8BF7\u8F93\u5165\u5FC5\u586B\u7684\u5143\u6570\u636E\u5B57\u6BB5\uFF0C\u7528\u9017\u53F7\u5206\u9694","Please enter the required metadata fields, separated by commas")).addText(r=>r.setPlaceholder("type,status,domain").setValue(this.plugin.settings.requiredMetadataFields.join(",")).onChange(async l=>{this.plugin.settings.requiredMetadataFields=l.split(",").map(o=>o.trim()).filter(o=>o.length>0),await this.plugin.saveSettings()})),new b.Setting(i).setName(e("\u6700\u5927\u7B14\u8BB0\u957F\u5EA6","Maximum Note Length")).setDesc(e("\u8D85\u8FC7\u6B64\u957F\u5EA6\u7684\u7B14\u8BB0\u5C06\u88AB\u6807\u8BB0\u4E3A\u95EE\u9898","Notes exceeding this length will be flagged as issues")).addText(r=>r.setPlaceholder("1500").setValue(this.plugin.settings.maxNoteLength.toString()).onChange(async l=>{let o=parseInt(l);isNaN(o)||(this.plugin.settings.maxNoteLength=o,await this.plugin.saveSettings())})),new b.Setting(i).setName(e("\u6700\u5C0F\u4E0A\u4E0B\u6587\u957F\u5EA6","Minimum Context Length")).setDesc(e("\u68C0\u67E5\u88F8\u94FE\u63A5\u65F6\u7684\u4E0A\u4E0B\u6587\u957F\u5EA6","Context length when checking naked links")).addText(r=>r.setPlaceholder("30").setValue(this.plugin.settings.minContextLength.toString()).onChange(async l=>{let o=parseInt(l);isNaN(o)||(this.plugin.settings.minContextLength=o,await this.plugin.saveSettings())})),new b.Setting(i).setName(e("\u6392\u9664\u6587\u4EF6\u5939","Excluded Folders")).setDesc(e("\u8BF7\u8F93\u5165\u8981\u6392\u9664\u7684\u6587\u4EF6\u5939\u8DEF\u5F84\uFF0C\u7528\u9017\u53F7\u5206\u9694","Please enter the folder paths to exclude, separated by commas")).addText(r=>r.setPlaceholder("templates,archive").setValue(this.plugin.settings.excludedFolders.join(",")).onChange(async l=>{this.plugin.settings.excludedFolders=l.split(",").map(o=>o.trim()).filter(o=>o.length>0),await this.plugin.saveSettings()})),new b.Setting(i).setName(e("\u6392\u9664\u6807\u7B7E","Excluded Tags")).setDesc(e("\u8BF7\u8F93\u5165\u8981\u6392\u9664\u7684\u6807\u7B7E(tags)\uFF0C\u7528\u9017\u53F7\u5206\u9694","Please enter the tags to exclude, separated by commas")).addText(r=>r.setPlaceholder("draft,template").setValue(this.plugin.settings.excludedTags.join(",")).onChange(async l=>{this.plugin.settings.excludedTags=l.split(",").map(o=>o.trim()).filter(o=>o.length>0),await this.plugin.saveSettings()})),new b.Setting(i).setName(e("\u77E5\u8BC6\u539F\u5B50\u7C7B\u578B","Knowledge Atom Types")).setDesc(e("\u8BF7\u8F93\u5165\u88AB\u89C6\u4E3A\u77E5\u8BC6\u539F\u5B50\u7684\u7B14\u8BB0\u7C7B\u578B(type)\uFF0C\u7528\u9017\u53F7\u5206\u9694","Please enter the note types (type) considered as knowledge atoms, separated by commas")).addText(r=>r.setPlaceholder("atom,concept,entity").setValue(this.plugin.settings.knowledgeAtomTypes.join(",")).onChange(async l=>{this.plugin.settings.knowledgeAtomTypes=l.split(",").map(o=>o.trim()).filter(o=>o.length>0),await this.plugin.saveSettings()})),new b.Setting(i).setName(e("\u5BFC\u51FA\u6A21\u677F","Export Template")).setDesc(e("\u8BBE\u7F6E\u5BFC\u51FAJSONL\u7684\u6A21\u677F","Set the template for exporting JSONL")).addTextArea(r=>{r.setPlaceholder('{"content": "{{content}}", "tags": "{{tags}}", "type": "{{type}}"}').setValue(this.plugin.settings.exportTemplate).onChange(async l=>{this.plugin.settings.exportTemplate=l,await this.plugin.saveSettings()}),r.inputEl.rows=4,r.inputEl.cols=50}),new b.Setting(i).setName(e("\u767D\u540D\u5355\u7BA1\u7406","Whitelist Management")).setDesc(e("\u4EE5\u4E0B\u95EE\u9898\u5DF2\u88AB\u6DFB\u52A0\u5230\u767D\u540D\u5355\u4E2D\uFF0C\u4E0D\u4F1A\u5728\u8BCA\u65AD\u4E2D\u663E\u793A\u3002","The following issues have been added to the whitelist and will not be displayed in the diagnosis."));let a=i.createEl("div",{cls:"knowledge-ark-ignored-issues"}),n=()=>{if(a.empty(),this.plugin.settings.ignoredIssues.length===0){a.createEl("p",{text:e("\u6682\u65E0\u88AB\u5FFD\u7565\u7684\u95EE\u9898\u3002","No ignored issues.")});return}let r=a.createEl("button",{text:e("\u5168\u90E8\u79FB\u9664","Remove All"),cls:"knowledge-ark-ignored-issue-button"});r.style.marginBottom="10px",r.onClickEvent(async()=>{this.plugin.settings.ignoredIssues=[],await this.plugin.saveSettings(),n()});let l=a.createEl("ul");this.plugin.settings.ignoredIssues.forEach((o,d)=>{let h=l.createEl("li",{cls:"knowledge-ark-ignored-issue-item"}),m=h.createEl("span",{text:o,cls:"knowledge-ark-ignored-issue-text"});h.createEl("button",{text:e("\u79FB\u9664","Remove"),cls:"knowledge-ark-ignored-issue-button"}).onClickEvent(async()=>{this.plugin.settings.ignoredIssues.splice(d,1),await this.plugin.saveSettings(),n()})})};n();let g=e("\u8BCA\u65AD\u89C4\u5219\u6743\u91CD\u914D\u7F6E","Diagnostic Rule Weights Configuration");i.createEl("h3",{text:g});let p=e("\u4E3A\u6BCF\u4E2A\u8BCA\u65AD\u89C4\u5219\u8BBE\u7F6E\u5355\u9879\u6263\u5206\u503C\u3002\u6263\u5206\u503C\u8D8A\u9AD8\uFF0C\u8BE5\u95EE\u9898\u5BF9\u5065\u5EB7\u5EA6\u603B\u5206\u7684\u5F71\u54CD\u8D8A\u5927\u3002","Set the penalty points for each diagnostic rule. Higher penalty points mean the issue will have a greater impact on the health score.");i.createEl("p",{text:p});let f=[{id:"metadata-integrity",name:e("\u5143\u6570\u636E\u5B8C\u6574\u6027\u68C0\u67E5","Metadata Integrity Check"),default:5},{id:"naked-links",name:e("\u88F8\u94FE\u63A5\u68C0\u67E5","Naked Links Check"),default:2},{id:"graph-connectivity",name:e("\u77E5\u8BC6\u56FE\u8C31\u8FDE\u63A5\u6027\u68C0\u67E5","Knowledge Graph Connectivity Check"),default:1},{id:"note-atomicity",name:e("\u7B14\u8BB0\u539F\u5B50\u5316\u7A0B\u5EA6\u68C0\u67E5","Note Atomicity Check"),default:.8},{id:"predicate-consistency",name:e("\u5173\u7CFB\u8C13\u8BED\u4E00\u81F4\u6027\u68C0\u67E5","Predicate Consistency Check"),default:.5},{id:"word-count-exceed",name:e("\u7B14\u8BB0\u957F\u5EA6\u8D85\u9650","Word Count Exceed"),default:.1}];for(let r of f){let l=this.plugin.settings.ruleWeights[r.id]!==void 0?this.plugin.settings.ruleWeights[r.id]:r.default;new b.Setting(i).setName(r.name).addText(o=>o.setPlaceholder(r.default.toString()).setValue(l.toString()).onChange(async d=>{let h=parseFloat(d);isNaN(h)||(this.plugin.settings.ruleWeights[r.id]=h,await this.plugin.saveSettings())}))}}};var j=require("obsidian");var G=require("obsidian"),N=class{constructor(c,i){this.plugin=c;this.app=i}async exportHealthyNotes(c){var f,r;let i=this.app.vault.getMarkdownFiles(),t=i.filter(l=>!c.some(o=>o.filePath===l.path));t=t.filter(l=>!this.plugin.settings.excludedFolders.some(o=>l.path.startsWith(o+"/")||l.path===o)),t=t.filter(l=>{let o=this.app.metadataCache.getFileCache(l);if(o&&o.tags&&this.plugin.settings.excludedTags.length>0){let d=o.tags.map(h=>h.tag);return!this.plugin.settings.excludedTags.some(h=>d.includes(h))}return!0}),console.log("Excluded folders:",this.plugin.settings.excludedFolders),console.log("Excluded tags:",this.plugin.settings.excludedTags);let s=i.filter(l=>{if(!c.some(m=>m.filePath===l.path)||this.plugin.settings.excludedFolders.some(m=>l.path.startsWith(m+"/")||l.path===m))return!1;let h=this.app.metadataCache.getFileCache(l);if(h&&h.tags&&this.plugin.settings.excludedTags.length>0){let m=h.tags.map(k=>k.tag);if(this.plugin.settings.excludedTags.some(k=>m.includes(k)))return!1}return!0});new G.Notice(`\u5BFC\u51FA ${t.length} \u4E2A\u5065\u5EB7\u7B14\u8BB0\uFF0C${s.length} \u4E2A\u7B14\u8BB0\u6709\u95EE\u9898\u3002`);let e=[];for(let l of t){if(this.plugin.settings.excludedFolders.some(u=>l.path.startsWith(u+"/")||l.path===u))continue;let o=this.app.metadataCache.getFileCache(l);if(o&&o.tags&&this.plugin.settings.excludedTags.length>0){let u=o.tags.map(k=>k.tag);if(this.plugin.settings.excludedTags.some(k=>u.includes(k)))continue}let d=await this.app.vault.read(l),h={},m=this.plugin.settings.exportTemplate.replace("{{content}}",JSON.stringify(d)).replace("{{tags}}",JSON.stringify(((f=o==null?void 0:o.tags)==null?void 0:f.map(u=>u.tag).join(", "))||"")).replace("{{type}}",JSON.stringify(((r=o==null?void 0:o.frontmatter)==null?void 0:r.type)||"")).replace("{{fileName}}",JSON.stringify(l.name)).replace("{{filePath}}",JSON.stringify(l.path)).replace("{{frontmatter}}",JSON.stringify((o==null?void 0:o.frontmatter)||{})).replace("{{links}}",JSON.stringify((o==null?void 0:o.links)||[])).replace("{{headings}}",JSON.stringify((o==null?void 0:o.headings)||[]));try{let u=JSON.parse(m);e.push(JSON.stringify(u)),console.log(`Successfully parsed template for file ${l.path}`)}catch(u){console.error(`Error parsing template for file ${l.path}:`,u),console.error(`Template content: ${m}`)}}let a=e.join(`
`),n=new Blob([a],{type:"application/jsonl"}),g=URL.createObjectURL(n),p=document.createElement("a");p.href=g,p.download="knowledge-ark-export.jsonl",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(g)}};var st=()=>{let y="knowledge-ark-health-score-styles";if(document.getElementById(y))return;let c=document.createElement("style");c.id=y,c.textContent=`
    .knowledge-ark-score.score-healthy {
      color: #28a745 !important; /* Green */
      font-size: 1.2em !important;
      font-weight: bold !important;
    }
    
    .knowledge-ark-score.score-warning {
      color: #ffc107 !important; /* Yellow */
      font-size: 1.2em !important;
      font-weight: bold !important;
    }
    
    .knowledge-ark-score.score-critical {
      color: #dc3545 !important; /* Red */
      font-size: 1.2em !important;
      font-weight: bold !important;
    }
  `,document.head.appendChild(c)};st();var F="knowledge-ark-view",K=class extends j.ItemView{constructor(i,t){super(i);this.plugin=t}getViewType(){return F}getDisplayText(){return this.plugin.settings.language==="en"?"Knowledge Ark Diagnostic Center":"\u77E5\u8BC6\u65B9\u821F\u8BCA\u65AD\u4E2D\u5FC3"}async onOpen(){let i=this.containerEl.children[1],t=this.plugin.settings.language==="en";i.empty(),i.createEl("h2",{text:t?"Knowledge Ark Diagnostic Center":"\u77E5\u8BC6\u65B9\u821F\u8BCA\u65AD\u4E2D\u5FC3"});let s=i.createEl("div",{cls:"knowledge-ark-header"}),e=s.createEl("button",{text:t?"Start Full Diagnosis":"\u5F00\u59CB\u5168\u9762\u8BCA\u65AD",cls:"knowledge-ark-button primary"}),a=s.createEl("button",{text:t?"Start Incremental Diagnosis":"\u65B0\u589E\u7B14\u8BB0\u8BCA\u65AD",cls:"knowledge-ark-button primary"}),n=s.createEl("button",{text:t?"Export Healthy Notes":"\u5BFC\u51FA\u5065\u5EB7\u7B14\u8BB0",cls:"knowledge-ark-button secondary"}),g=s.createEl("div",{cls:"knowledge-ark-metrics"}),p=g.createEl("div",{text:t?"Health Score: --%":"\u5065\u5EB7\u5EA6\u603B\u5206: --%",cls:"knowledge-ark-score"}),f=g.createEl("div",{text:t?"Knowledge Atom Stats: --":"\u77E5\u8BC6\u539F\u5B50\u7EDF\u8BA1: --",cls:"knowledge-ark-atom-count"}),r=g.createEl("div",{text:t?"Connection Density: --":"\u8FDE\u63A5\u5BC6\u5EA6: --",cls:"knowledge-ark-connection-density"}),l=i.createEl("div",{cls:"knowledge-ark-results"}),o=this.plugin.settings.savedDiagnosisResults;if(o)p.setText(t?`Health Score: ${o.healthScore}%`:`\u5065\u5EB7\u5EA6\u603B\u5206: ${o.healthScore}%`),p.className=`knowledge-ark-score ${this.getScoreClass(o.healthScore)}`,f.setText(t?`Knowledge Atom Stats: ${o.atomCount}`:`\u77E5\u8BC6\u539F\u5B50\u7EDF\u8BA1: ${o.atomCount}`),r.setText(t?`Connection Density: ${o.connectionDensity}`:`\u8FDE\u63A5\u5BC6\u5EA6: ${o.connectionDensity}`),l.empty(),o.issues.length===0?l.createEl("p",{text:t?"Congratulations! Your knowledge base is very healthy.":"\u606D\u559C\uFF01\u60A8\u7684\u77E5\u8BC6\u5E93\u975E\u5E38\u5065\u5EB7\u3002",cls:"knowledge-ark-placeholder"}):(this.renderDiagnosticCards(l,o.issues),await this.renderHealthyNotes(l));else{let d=l.createEl("p",{text:t?'Click "Start Full Diagnosis" to analyze your knowledge ark':'\u70B9\u51FB"\u5F00\u59CB\u5168\u9762\u8BCA\u65AD"\u4EE5\u5206\u6790\u60A8\u7684\u77E5\u8BC6\u65B9\u821F',cls:"knowledge-ark-placeholder"})}r.addEventListener("mouseenter",d=>{let m=this.calculateConnectionDensity().match(/\[↑ ([0-9.]+)\] \[↓ ([0-9.]+)\]/),u="0",k="0";m&&m.length===3&&(u=m[1],k=m[2]);let v=document.createElement("div");v.className="knowledge-ark-tooltip",v.textContent=t?`Each note is referenced by an average of ${u} other notes / Each note references an average of ${k} other notes`:`\u5E73\u5747\u6BCF\u4E2A\u7B14\u8BB0\u88AB${u}\u4E2A\u5176\u4ED6\u7B14\u8BB0\u6240\u5F15\u7528 / \u5E73\u5747\u6BCF\u4E2A\u7B14\u8BB0\u5F15\u7528\u4E86${k}\u4E2A\u5176\u4ED6\u7B14\u8BB0`,v.style.position="absolute",v.style.left=`${d.pageX}px`,v.style.top=`${d.pageY-30}px`,document.body.appendChild(v)}),r.addEventListener("mouseleave",()=>{document.querySelectorAll(".knowledge-ark-tooltip").forEach(h=>h.remove())}),e.onClickEvent(async()=>{e.setText(t?"Diagnosing...":"\u8BCA\u65AD\u4E2D..."),e.disabled=!0;let d=await this.plugin.runDiagnostics(),h=this.calculateHealthScore(d);p.setText(t?`Health Score: ${h}%`:`\u5065\u5EB7\u5EA6\u603B\u5206: ${h}%`),p.className=`knowledge-ark-score ${this.getScoreClass(h)}`;let m=this.calculateAtomCount();f.setText(t?`Knowledge Atom Stats: ${m}`:`\u77E5\u8BC6\u539F\u5B50\u7EDF\u8BA1: ${m}`);let u=this.calculateConnectionDensity();r.setText(t?`Connection Density: ${u}`:`\u8FDE\u63A5\u5BC6\u5EA6: ${u}`),this.plugin.settings.savedDiagnosisResults={issues:d,healthScore:h,atomCount:m,connectionDensity:u,diagnosisTime:Date.now()},await this.plugin.saveSettings(),l.empty(),d.length===0?l.createEl("p",{text:t?"Congratulations! Your knowledge base is very healthy.":"\u606D\u559C\uFF01\u60A8\u7684\u77E5\u8BC6\u5E93\u975E\u5E38\u5065\u5EB7\u3002",cls:"knowledge-ark-placeholder"}):(this.renderDiagnosticCards(l,d),await this.renderHealthyNotes(l)),e.setText(t?"Start Full Diagnosis":"\u5F00\u59CB\u5168\u9762\u8BCA\u65AD"),e.disabled=!1}),a.onClickEvent(async()=>{a.setText(t?"Diagnosing...":"\u8BCA\u65AD\u4E2D..."),a.disabled=!0;let d=await this.plugin.runDiagnostics(!0),h=d;if(this.plugin.settings.savedDiagnosisResults){let v=new Set(this.app.vault.getMarkdownFiles().map(E=>E.path)),w=this.plugin.settings.savedDiagnosisResults.issues.filter(E=>v.has(E.filePath)),D=new Set(w.map(E=>E.id)),L=d.filter(E=>!D.has(E.id));h=[...w,...L]}let m=this.calculateHealthScore(h);p.setText(t?`Health Score: ${m}%`:`\u5065\u5EB7\u5EA6\u603B\u5206: ${m}%`),p.className=`knowledge-ark-score ${this.getScoreClass(m)}`;let u=this.calculateAtomCount();f.setText(t?`Knowledge Atom Stats: ${u}`:`\u77E5\u8BC6\u539F\u5B50\u7EDF\u8BA1: ${u}`);let k=this.calculateConnectionDensity();r.setText(t?`Connection Density: ${k}`:`\u8FDE\u63A5\u5BC6\u5EA6: ${k}`),this.plugin.settings.savedDiagnosisResults={issues:h,healthScore:m,atomCount:u,connectionDensity:k,diagnosisTime:Date.now()},await this.plugin.saveSettings(),l.empty(),h.length===0?l.createEl("p",{text:t?"Congratulations! Your knowledge base is very healthy.":"\u606D\u559C\uFF01\u60A8\u7684\u77E5\u8BC6\u5E93\u975E\u5E38\u5065\u5EB7\u3002",cls:"knowledge-ark-placeholder"}):(this.renderDiagnosticCards(l,h),await this.renderHealthyNotes(l)),a.setText(t?"Start Incremental Diagnosis":"\u65B0\u589E\u7B14\u8BB0\u8BCA\u65AD"),a.disabled=!1}),n.onClickEvent(async()=>{n.setText(t?"Exporting...":"\u5BFC\u51FA\u4E2D..."),n.disabled=!0;let d=await this.plugin.runDiagnostics();await this.plugin.exportHealthyNotes(d),n.setText(t?"Export Healthy Notes":"\u5BFC\u51FA\u5065\u5EB7\u7B14\u8BB0"),n.disabled=!1})}calculateHealthScore(i){let t=i.filter(n=>!this.plugin.settings.ignoredIssues.includes(n.id)),s=0,e={};for(let n of t)e[n.ruleId]||(e[n.ruleId]=0),e[n.ruleId]++;for(let[n,g]of Object.entries(e)){let p=this.plugin.settings.ruleWeights[n]||0;s+=g*p}let a=Math.max(0,100-s);return Math.round(a)}getScoreClass(i){return i>=90?"score-healthy":i>=70?"score-warning":"score-critical"}renderDiagnosticCards(i,t){let s=this.plugin.settings.language==="en",e=t.filter(n=>!this.plugin.settings.ignoredIssues.includes(n.id)),a={};for(let n of e)a[n.ruleId]||(a[n.ruleId]=[]),a[n.ruleId].push(n);for(let[n,g]of Object.entries(a)){let p=i.createEl("div",{cls:"knowledge-ark-card"}),f=p.createEl("div",{cls:"knowledge-ark-card-header"}),r=f.createEl("div",{cls:"knowledge-ark-card-title-container"}),l=r.createEl("div",{cls:"knowledge-ark-card-title"}),o=g[0].ruleId,d=s?"Issue Description":"\u95EE\u9898\u63CF\u8FF0",h=s?{"metadata-integrity":{name:"Metadata Integrity Check",description:"Check if note files contain standard YAML Frontmatter"},"note-atomicity":{name:"Note Atomicity Check",description:"Check if notes are too lengthy or have scattered topics"},"naked-links":{name:"Naked Links Check",description:"Check if internal links lack sufficient context"},"graph-connectivity":{name:"Knowledge Graph Connectivity Check",description:'Check for unconnected "information islands"'},"predicate-consistency":{name:"Predicate Consistency Check",description:"Encourage the standard use of `key:: [[Link]]`"}}:{"metadata-integrity":{name:"\u5143\u6570\u636E\u5B8C\u6574\u6027\u68C0\u67E5",description:"\u68C0\u67E5\u7B14\u8BB0\u6587\u4EF6\u662F\u5426\u5305\u542B\u89C4\u8303\u7684YAML Frontmatter"},"note-atomicity":{name:"\u7B14\u8BB0\u539F\u5B50\u5316\u7A0B\u5EA6\u68C0\u67E5",description:"\u68C0\u67E5\u7B14\u8BB0\u662F\u5426\u8FC7\u4E8E\u5197\u957F\u6216\u4E3B\u9898\u5206\u6563"},"naked-links":{name:"\u88F8\u94FE\u63A5\u68C0\u67E5",description:"\u68C0\u67E5\u5185\u90E8\u94FE\u63A5\u662F\u5426\u7F3A\u5C11\u8DB3\u591F\u7684\u4E0A\u4E0B\u6587"},"graph-connectivity":{name:"\u77E5\u8BC6\u56FE\u8C31\u8FDE\u63A5\u6027\u68C0\u67E5",description:'\u68C0\u67E5\u662F\u5426\u5B58\u5728\u672A\u88AB\u8FDE\u63A5\u7684"\u4FE1\u606F\u5B64\u5C9B"'},"predicate-consistency":{name:"\u5173\u7CFB\u8C13\u8BED\u4E00\u81F4\u6027\u68C0\u67E5",description:"\u9F13\u52B1`key:: [[Link]]`\u7684\u89C4\u8303\u4F7F\u7528"}};h[n]&&(o=h[n].name,d=h[n].description),l.createEl("span",{text:`\u26A0\uFE0F ${o}`}),r.createEl("div",{text:d,cls:"knowledge-ark-card-description"});let m=f.createEl("div",{cls:"knowledge-ark-badge-toggle-container"});m.createEl("span",{text:g.length.toString(),cls:"knowledge-ark-card-badge"});let u=m.createEl("button",{cls:"knowledge-ark-card-toggle"}),k='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',v='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>';u.innerHTML=k;let w=p.createEl("div",{cls:"knowledge-ark-card-content"});w.hide();let D=w.createEl("table",{cls:"knowledge-ark-issue-table"}),E=D.createEl("thead").createEl("tr");E.createEl("th",{text:s?"File Name":"\u6587\u4EF6\u540D"}),E.createEl("th",{text:s?"Context Preview":"\u4E0A\u4E0B\u6587\u9884\u89C8"}),E.createEl("th",{text:s?"Actions":"\u64CD\u4F5C"});let M=D.createEl("tbody");for(let x of g){let T=M.createEl("tr");T.createEl("td").createEl("a",{text:x.fileName,href:"#"}).onClickEvent(R=>{R.preventDefault(),this.navigateToIssue(x.filePath,x.position)}),T.createEl("td",{text:x.contextPreview,cls:"knowledge-ark-issue-context"});let P=T.createEl("td",{cls:"knowledge-ark-issue-actions"});P.createEl("button",{text:s?"Jump":"\u8DF3\u8F6C",cls:"knowledge-ark-issue-button"}).onClickEvent(()=>{this.navigateToIssue(x.filePath,x.position)});let A=P.createEl("button",{text:s?"Ignore":"\u5FFD\u7565",cls:"knowledge-ark-issue-button"});if(A.onClickEvent(()=>{this.ignoreIssue(x.id),T.remove()}),this.plugin.settings.ignoredIssues.includes(x.id)){let R=P.createEl("button",{text:s?"Unignore":"\u53D6\u6D88\u5FFD\u7565",cls:"knowledge-ark-issue-button"});R.onClickEvent(()=>{this.unignoreIssue(x.id),A.setText("\u5FFD\u7565"),R.remove()})}}let C=()=>{w.isShown()?(w.hide(),u.innerHTML=k):(w.show(),u.innerHTML=v)};u.onClickEvent(x=>{x.stopPropagation(),C()}),f.onClickEvent(C)}}async renderHealthyNotes(i){var E,M;let t=this.plugin.settings.language==="en",s=i.createEl("div",{cls:"knowledge-ark-healthy-notes-section"}),e=s.createEl("div",{cls:"knowledge-ark-card-header"}),n=e.createEl("div",{cls:"knowledge-ark-card-title-container"}).createEl("div",{cls:"knowledge-ark-card-title"});n.createEl("span",{text:"\u2705 "}),n.createEl("span",{text:t?"Healthy Notes List":"\u5065\u5EB7\u7B14\u8BB0\u5217\u8868"});let g=await this.plugin.runDiagnostics(),p=new N(this.plugin,this.app),l=this.app.vault.getMarkdownFiles().filter(C=>{var P;let x=this.plugin.settings.excludedFolders.some(S=>C.path.startsWith(S+"/")),T=this.app.metadataCache.getFileCache(C),z=((P=T==null?void 0:T.tags)==null?void 0:P.map(S=>S.tag))||[],$=this.plugin.settings.excludedTags.some(S=>z.includes("#"+S));return!x&&!$}).filter(C=>!g.some(x=>x.filePath===C.path)),o=e.createEl("div",{cls:"knowledge-ark-badge-toggle-container"});o.createEl("span",{text:l.length.toString(),cls:"knowledge-ark-card-badge"});let d=o.createEl("button",{cls:"knowledge-ark-card-toggle"}),h='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',m='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>';d.innerHTML=h;let u=s.createEl("div",{cls:"knowledge-ark-card-content"});u.hide(),n.createEl("span",{text:"\u2705 "}),n.createEl("span",{text:t?"Healthy Notes List":"\u5065\u5EB7\u7B14\u8BB0\u5217\u8868"});let k=u.createEl("table",{cls:"knowledge-ark-issue-table"}),w=k.createEl("thead").createEl("tr");w.createEl("th",{text:t?"File Name":"\u6587\u4EF6\u540D"}),w.createEl("th",{text:t?"Tags":"\u6807\u7B7E"}),w.createEl("th",{text:t?"Type":"\u7C7B\u578B"});let D=k.createEl("tbody");for(let C of l){let x=D.createEl("tr");x.createEl("td").createEl("a",{text:C.name,href:"#"}).onClickEvent(A=>{A.preventDefault(),this.app.workspace.getLeaf(!0).openFile(C)});let $=this.app.metadataCache.getFileCache(C),P=((E=$==null?void 0:$.tags)==null?void 0:E.map(A=>A.tag).join(", "))||"",S=((M=$==null?void 0:$.frontmatter)==null?void 0:M.type)||"";x.createEl("td",{text:P}),x.createEl("td",{text:S})}let L=()=>{u.isShown()?(u.hide(),d.innerHTML=h):(u.show(),d.innerHTML=m)};d.onClickEvent(C=>{C.stopPropagation(),L()}),e.onClickEvent(L)}calculateAtomCount(){var s;let i=this.app.vault.getMarkdownFiles(),t=0;for(let e of i){let a=this.app.metadataCache.getFileCache(e),n=(s=a==null?void 0:a.frontmatter)==null?void 0:s.type;n&&this.plugin.settings.knowledgeAtomTypes.includes(n)&&t++}return t}calculateConnectionDensity(){var f;let i=this.app.vault.getMarkdownFiles(),t=i.filter(r=>{var m;let l=this.plugin.settings.excludedFolders.some(u=>r.path.startsWith(u+"/")),o=this.app.metadataCache.getFileCache(r),d=((m=o==null?void 0:o.tags)==null?void 0:m.map(u=>u.tag))||[],h=this.plugin.settings.excludedTags.some(u=>d.includes("#"+u));return!l&&!h}),s=t.length;if(s===0)return"[\u2191 0] [\u2193 0]";let e=0,a=0,n=this.app.metadataCache.resolvedLinks;for(let r of t){let l=n[r.path]?Object.values(n[r.path]).reduce((d,h)=>d+h,0):0;a+=l;let o=0;for(let d in n){let h=i.find(m=>m.path===d);if(h){let m=this.app.metadataCache.getFileCache(h),u=((f=m==null?void 0:m.tags)==null?void 0:f.map(w=>w.tag))||[],k=this.plugin.settings.excludedFolders.some(w=>h.path.startsWith(w+"/")),v=this.plugin.settings.excludedTags.some(w=>u.includes("#"+w));!k&&!v&&n[d][r.path]&&(o+=n[d][r.path])}}e+=o}let g=(e/s).toFixed(1),p=(a/s).toFixed(1);return`[\u2191 ${g}] [\u2193 ${p}]`}async navigateToIssue(i,t){let s=this.app.vault.getAbstractFileByPath(i);if(s){let e=this.app.workspace.getLeaf(!0);await e.openFile(s);let a=e.view instanceof j.MarkdownView?e.view.editor:null;if(a){let n=a.offsetToPos(t.start);a.setCursor(n),a.scrollIntoView({from:n,to:n},!0)}}else console.error(`File not found: ${i}`)}ignoreIssue(i){this.plugin.settings.ignoredIssues.includes(i)||(this.plugin.settings.ignoredIssues.push(i),this.plugin.saveSettings())}unignoreIssue(i){let t=this.plugin.settings.ignoredIssues.indexOf(i);t>-1&&(this.plugin.settings.ignoredIssues.splice(t,1),this.plugin.saveSettings())}async onClose(){}};var O=class{constructor(c,i){this.plugin=c;this.app=i;this.id="metadata-integrity";this.name="\u5143\u6570\u636E\u5B8C\u6574\u6027\u68C0\u67E5";this.description="\u68C0\u67E5\u7B14\u8BB0\u6587\u4EF6\u662F\u5426\u5305\u542B\u89C4\u8303\u7684YAML Frontmatter"}async check(){let c=[],i=this.app.vault.getMarkdownFiles();for(let t of i){if(this.plugin.settings.excludedFolders.some(a=>t.path.startsWith(a)))continue;let s=this.app.metadataCache.getFileCache(t);if(s&&s.frontmatter&&s.frontmatter.tags&&(Array.isArray(s.frontmatter.tags)?s.frontmatter.tags:s.frontmatter.tags.split(",").map(n=>n.trim())).some(n=>this.plugin.settings.excludedTags.includes(n)))continue;if(!s||!s.frontmatter){c.push({id:`${this.id}-${t.path}`,ruleId:this.id,filePath:t.path,fileName:t.name,contextPreview:this.plugin.settings.language==="en"?"Missing YAML Frontmatter":"\u7F3A\u5C11YAML Frontmatter",position:{start:0,end:0},severity:"high",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${t.path}`)});continue}let e=[];for(let a of this.plugin.settings.requiredMetadataFields)a in s.frontmatter||e.push(a);e.length>0&&c.push({id:`${this.id}-${t.path}`,ruleId:this.id,filePath:t.path,fileName:t.name,contextPreview:this.plugin.settings.language==="en"?`Missing required fields: ${e.join(", ")}`:`\u7F3A\u5C11\u5FC5\u586B\u5B57\u6BB5: ${e.join(", ")}`,position:{start:0,end:0},severity:"medium",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${t.path}`)})}return c}},W=class{constructor(c,i){this.plugin=c;this.app=i;this.id="note-atomicity";this.name="\u7B14\u8BB0\u539F\u5B50\u5316\u7A0B\u5EA6\u68C0\u67E5";this.description="\u68C0\u67E5\u7B14\u8BB0\u662F\u5426\u8FC7\u4E8E\u5197\u957F\u6216\u4E3B\u9898\u5206\u6563"}async check(){let c=[],i=this.app.vault.getMarkdownFiles();for(let t of i){if(this.plugin.settings.excludedFolders.some(p=>t.path.startsWith(p)))continue;let s=this.app.metadataCache.getFileCache(t);if(s&&s.frontmatter&&s.frontmatter.tags&&(Array.isArray(s.frontmatter.tags)?s.frontmatter.tags:s.frontmatter.tags.split(",").map(f=>f.trim())).some(f=>this.plugin.settings.excludedTags.includes(f)))continue;let e=await this.app.vault.read(t);e.length>this.plugin.settings.maxNoteLength&&c.push({id:`${this.id}-${t.path}`,ruleId:this.id,filePath:t.path,fileName:t.name,contextPreview:this.plugin.settings.language==="en"?`Note length (${e.length}) exceeds threshold (${this.plugin.settings.maxNoteLength})`:`\u7B14\u8BB0\u957F\u5EA6 (${e.length}) \u8D85\u8FC7\u9608\u503C (${this.plugin.settings.maxNoteLength})`,position:{start:0,end:0},severity:"medium",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${t.path}`)});let a=e.replace(/```[\s\S]*?```/g,"").replace(/```[\s\S]*$/g,"");a=a.replace(/`[^`]*`/g,""),a=a.replace(/---[\s\S]*?---/,"");let n=(a.match(/^#\s/gm)||[]).length,g=(a.match(/^##\s/gm)||[]).length;n>1?c.push({id:`${this.id}-${t.path}-h1`,ruleId:this.id,filePath:t.path,fileName:t.name,contextPreview:this.plugin.settings.language==="en"?`Found ${n} H1 headers and ${g} H2 headers`:`\u53D1\u73B0 ${n} \u4E2AH1\u6807\u9898\uFF0C${g} \u4E2AH2\u6807\u9898`,position:{start:0,end:0},severity:"medium",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${t.path}-h1`)}):g>=5&&c.push({id:`${this.id}-${t.path}-h2`,ruleId:this.id,filePath:t.path,fileName:t.name,contextPreview:this.plugin.settings.language==="en"?`Found ${g} H2 headers, consider splitting the note`:`\u53D1\u73B0 ${g} \u4E2AH2\u6807\u9898\uFF0C\u5EFA\u8BAE\u8003\u8651\u62C6\u5206\u7B14\u8BB0`,position:{start:0,end:0},severity:"low",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${t.path}-h2`)})}return c}},B=class{constructor(c,i){this.plugin=c;this.app=i;this.id="naked-links";this.name="\u88F8\u94FE\u63A5\u68C0\u67E5";this.description="\u68C0\u67E5\u5185\u90E8\u94FE\u63A5\u662F\u5426\u7F3A\u5C11\u8DB3\u591F\u7684\u4E0A\u4E0B\u6587"}async check(){let c=[],i=this.app.vault.getMarkdownFiles();for(let t of i){if(this.plugin.settings.excludedFolders.some(n=>t.path.startsWith(n)))continue;let s=this.app.metadataCache.getFileCache(t);if(s&&s.frontmatter&&s.frontmatter.tags&&(Array.isArray(s.frontmatter.tags)?s.frontmatter.tags:s.frontmatter.tags.split(",").map(g=>g.trim())).some(g=>this.plugin.settings.excludedTags.includes(g)))continue;let e=await this.app.vault.read(t),a=this.app.metadataCache.getFileCache(t);if(!(!a||!a.links))for(let n of a.links){if(n.link.startsWith("http"))continue;let g=n.position.start.offset,p=n.position.end.offset,f=Math.max(0,g-this.plugin.settings.minContextLength),r=Math.min(e.length,p+this.plugin.settings.minContextLength),l=e.substring(f,r),o=n.displayText||n.link,d=/[\u4e00-\u9fa5a-zA-Z0-9]{2,}/.test(o),h=/[\u4e00-\u9fa5]/.test(l),m=/(总结|说明|参考|详见|见|关于|介绍|讨论|分析|描述|解释|定义|提供|展示|记录|表示|指出|强调|认为|觉得|发现|::)/,u=e.substring(f,g),k=e.substring(p,r),v=u+k,w=m.test(v),D=/\[\[[^\]]+\|[^\]]+\]\]/.test(e.substring(g-10,p+10))||/\[[^\]]+\]\([^)]+\)/.test(e.substring(g-10,p+10));!w&&!D&&c.push({id:`${this.id}-${t.path}-${g}`,ruleId:this.id,filePath:t.path,fileName:t.name,contextPreview:(this.plugin.settings.language==="en",l),position:{start:g,end:p},severity:"low",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${t.path}-${g}`)})}}return c}},V=class{constructor(c,i){this.plugin=c;this.app=i;this.id="graph-connectivity";this.name="\u77E5\u8BC6\u56FE\u8C31\u8FDE\u63A5\u6027\u68C0\u67E5";this.description='\u68C0\u67E5\u662F\u5426\u5B58\u5728\u672A\u88AB\u8FDE\u63A5\u7684"\u4FE1\u606F\u5B64\u5C9B"'}async check(){let c=[],i=this.app.vault.getMarkdownFiles(),t=new Map;for(let s of i){if(this.plugin.settings.excludedFolders.some(a=>s.path.startsWith(a)))continue;let e=this.app.metadataCache.getFileCache(s);if(!(e&&e.frontmatter&&e.frontmatter.tags&&(Array.isArray(e.frontmatter.tags)?e.frontmatter.tags:e.frontmatter.tags.split(",").map(n=>n.trim())).some(n=>this.plugin.settings.excludedTags.includes(n)))&&(t.has(s.path)||t.set(s.path,{inbound:0,outbound:0}),e&&e.links)){t.get(s.path).outbound+=e.links.length;for(let a of e.links)if(!a.link.startsWith("http")){let n=this.resolveLinkPath(s.path,a.link);n&&(t.has(n)||t.set(n,{inbound:0,outbound:0}),t.get(n).inbound+=1)}}}for(let[s,e]of t.entries()){let a=this.app.vault.getAbstractFileByPath(s);a&&(this.plugin.settings.excludedFolders.some(n=>a.path.startsWith(n))||(e.inbound===0&&e.outbound===0&&c.push({id:`${this.id}-${s}-isolated`,ruleId:this.id,filePath:s,fileName:a.name,contextPreview:this.plugin.settings.language==="en"?"Isolated node (inbound=0 and outbound=0)":"\u4FE1\u606F\u5B64\u5C9B\u8282\u70B9 (\u5165\u94FE=0 \u4E14 \u51FA\u94FE=0)",position:{start:0,end:0},severity:"medium",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${s}-isolated`)}),e.outbound===0&&e.inbound>0&&c.push({id:`${this.id}-${s}-leaf`,ruleId:this.id,filePath:s,fileName:a.name,contextPreview:this.plugin.settings.language==="en"?"Leaf node (outbound=0 but inbound>0)":"\u7EC8\u70B9\u8282\u70B9 (\u51FA\u94FE=0 \u4F46 \u5165\u94FE>0)",position:{start:0,end:0},severity:"low",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${s}-leaf`)})))}return c}resolveLinkPath(c,i){return`${c.substring(0,c.lastIndexOf("/"))}/${i}.md`}},J=class{constructor(c,i){this.plugin=c;this.app=i;this.id="predicate-consistency";this.name="\u5173\u7CFB\u8C13\u8BED\u4E00\u81F4\u6027\u68C0\u67E5";this.description="\u9F13\u52B1`key:: [[Link]]`\u7684\u89C4\u8303\u4F7F\u7528"}async check(){let c=[],i=this.app.vault.getMarkdownFiles(),t=new Map;for(let s of i){if(this.plugin.settings.excludedFolders.some(p=>s.path.startsWith(p)))continue;let e=this.app.metadataCache.getFileCache(s);if(e&&e.frontmatter&&e.frontmatter.tags&&(Array.isArray(e.frontmatter.tags)?e.frontmatter.tags:e.frontmatter.tags.split(",").map(f=>f.trim())).some(f=>this.plugin.settings.excludedTags.includes(f)))continue;let a=await this.app.vault.read(s),n=/(\w+)::/g,g;for(;(g=n.exec(a))!==null;){let p=g[1],f={start:g.index,end:g.index+g[0].length},r=Math.max(0,f.start-50),l=Math.min(a.length,f.end+50),o=a.substring(r,l);t.has(p)||t.set(p,{count:0,locations:[]});let d=t.get(p);d.count++,d.locations.push({filePath:s.path,fileName:s.name,position:f,contextPreview:o})}}for(let[s,e]of t.entries()){if(e.count<3)for(let n of e.locations)c.push({id:`${this.id}-${s}-${n.filePath}-${n.position.start}`,ruleId:this.id,filePath:n.filePath,fileName:n.fileName,contextPreview:this.plugin.settings.language==="en"?`Predicate "${s}" has low usage (${e.count} times): ${n.contextPreview}`:`\u8C13\u8BED "${s}" \u4F7F\u7528\u9891\u7387\u8FC7\u4F4E (${e.count} \u6B21): ${n.contextPreview}`,position:n.position,severity:"low",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${s}-${n.filePath}-${n.position.start}`)});let a=new Set;for(let[n,g]of t.entries())if(s!==n&&this.isSimilar(s,n)){let p=[s,n].sort().join("|");if(!a.has(p)&&(a.add(p),e.locations.length>0)){let f=e.locations[0];c.push({id:`${this.id}-${s}-${n}`,ruleId:this.id,filePath:f.filePath,fileName:f.fileName,contextPreview:this.plugin.settings.language==="en"?`Predicate "${s}" and "${n}" may have spelling similarity`:`\u8C13\u8BED "${s}" \u4E0E "${n}" \u53EF\u80FD\u5B58\u5728\u62FC\u5199\u76F8\u4F3C\u6027`,position:f.position,severity:"low",isIgnored:this.plugin.settings.ignoredIssues.includes(`${this.id}-${s}-${n}`)})}}}return c}isSimilar(c,i){let t=this.levenshteinDistance(c,i),s=Math.max(c.length,i.length);return s===0?!0:1-t/s>=.7}levenshteinDistance(c,i){let t=c.length,s=i.length,e=Array(t+1).fill(null).map(()=>Array(s+1).fill(0));for(let a=0;a<=t;a++)e[a][0]=a;for(let a=0;a<=s;a++)e[0][a]=a;for(let a=1;a<=t;a++)for(let n=1;n<=s;n++){let g=c[a-1]===i[n-1]?0:1;e[a][n]=Math.min(e[a-1][n]+1,e[a][n-1]+1,e[a-1][n-1]+g)}return e[t][s]}};var nt={requiredMetadataFields:["type","status","domain"],maxNoteLength:1500,minContextLength:50,excludedFolders:[],excludedTags:[],ignoredIssues:[],exportTemplate:'{"instruction": "\u8BF7\u6839\u636E\u4EE5\u4E0B\u5185\u5BB9\u751F\u6210\u77E5\u8BC6\u56FE\u8C31\u8282\u70B9\u548C\u5173\u7CFB", "input": {"content": {{content}}, "fileName": {{fileName}}, "filePath": {{filePath}}, "frontmatter": {{frontmatter}}}, "output": {"tags": {{tags}}, "type": {{type}}, "links": {{links}}, "headings": {{headings}}}}',knowledgeAtomTypes:["atom","concept","entity"],language:"zh",ruleWeights:{"metadata-integrity":5,"naked-links":2,"graph-connectivity":1,"note-atomicity":.8,"predicate-consistency":.5,"word-count-exceed":.1},lastDiagnosisTime:0},I=class{constructor(){this.rules=new Map}static getInstance(){return I.instance||(I.instance=new I),I.instance}registerRule(c,i){this.rules.set(c,i)}getRules(c,i){return Array.from(this.rules.values()).map(t=>new t(c,i))}getRuleIds(){return Array.from(this.rules.keys())}},Y=class extends q.Plugin{async onload(){await this.loadSettings();let i=I.getInstance();i.registerRule("metadata-integrity",O),i.registerRule("note-atomicity",W),i.registerRule("naked-links",B),i.registerRule("graph-connectivity",V),i.registerRule("predicate-consistency",J);let t=this.settings.language==="en"?"Knowledge Ark Diagnostic Center":"\u77E5\u8BC6\u65B9\u821F\u8BCA\u65AD\u4E2D\u5FC3";this.addRibbonIcon("lucide-compass",t,e=>{this.activateView()}).addClass("knowledge-ark-ribbon-class"),this.registerView(F,e=>new K(e,this)),this.addSettingTab(new H(this.app,this)),this.addCommand({id:"open-knowledge-ark-view",name:this.settings.language==="en"?"Open Knowledge Ark Diagnostic Center":"\u6253\u5F00\u77E5\u8BC6\u65B9\u821F\u8BCA\u65AD\u4E2D\u5FC3",callback:()=>{this.activateView()}})}async onunload(){this.app.workspace.detachLeavesOfType(F)}async loadSettings(){this.settings=Object.assign({},nt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){this.app.workspace.detachLeavesOfType(F);let i=this.app.workspace.getRightLeaf(!1);i&&(await i.setViewState({type:F,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(F)[0]))}async runDiagnostics(i=!1){let s=I.getInstance().getRules(this,this.app),e=this.settings.lastDiagnosisTime||0,a=this.app.vault.getMarkdownFiles(),n=a;i&&(n=a.filter(r=>r instanceof q.TFile&&r.stat.mtime>e));let g=s.map(async r=>{try{let l=await r.check();return i?l.filter(o=>n.some(d=>d.path===o.filePath)):l}catch(l){return console.error(`Error running diagnostic rule ${r.name}:`,l),[]}}),f=(await Promise.all(g)).flat();return i&&(this.settings.lastDiagnosisTime=Date.now(),await this.saveSettings()),f}async exportHealthyNotes(i){await new N(this,this.app).exportHealthyNotes(i)}};
